<!DOCTYPE html>
<html lang="fa" dir="rtl">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Ú†Ù†Ø¯ØŸ! | Ù‚ÛŒÙ…Øª Ù„Ø­Ø¸Ù‡â€ŒØ§ÛŒ</title>
<link href="https://fonts.googleapis.com/css2?family=Vazirmatn:wght@300;400;500;700;900&display=swap" rel="stylesheet">
<style>
  :root {
    --bg:#0f0f13;--card:#17171e;--card-hover:#1e1e28;--border:#2a2a38;
    --text:#f0f0f5;--muted:#6b6b80;--up:#00e676;--down:#ff5252;--accent:#7c6bff;
  }
  *{margin:0;padding:0;box-sizing:border-box}
  body{font-family:'Vazirmatn',sans-serif;background:var(--bg);color:var(--text);min-height:100vh;overflow-x:hidden}
  body::before{content:'';position:fixed;inset:0;background:
    radial-gradient(ellipse 60% 40% at 20% 20%,rgba(124,107,255,.08) 0%,transparent 60%),
    radial-gradient(ellipse 50% 50% at 80% 80%,rgba(0,230,118,.05) 0%,transparent 60%);
    pointer-events:none;z-index:0}

  .ticker-bar{background:rgba(124,107,255,.07);border-bottom:1px solid var(--border);padding:8px 0;overflow:hidden;white-space:nowrap}
  .ticker-inner{display:inline-block;animation:ticker 35s linear infinite;font-size:12px;color:var(--muted)}
  .ticker-item{display:inline-block;margin:0 24px}
  .ticker-item .name{color:var(--text);font-weight:600}
  .ticker-item .chg.up{color:var(--up)}.ticker-item .chg.down{color:var(--down)}
  @keyframes ticker{0%{transform:translateX(0)}100%{transform:translateX(-50%)}}

  .header{position:sticky;top:0;z-index:100;background:rgba(15,15,19,.9);backdrop-filter:blur(20px);
    border-bottom:1px solid var(--border);padding:14px 20px;display:flex;align-items:center;justify-content:space-between}
  .logo{font-size:26px;font-weight:900;background:linear-gradient(135deg,var(--accent),#b388ff);
    -webkit-background-clip:text;-webkit-text-fill-color:transparent}
  .logo span{background:linear-gradient(135deg,var(--up),#69f0ae);-webkit-background-clip:text;-webkit-text-fill-color:transparent}
  .last-update{font-size:11px;color:var(--muted)}
  .refresh-btn{background:none;border:1px solid var(--border);color:var(--muted);padding:7px 14px;
    border-radius:10px;cursor:pointer;font-family:'Vazirmatn',sans-serif;font-size:12px;
    transition:all .2s;display:flex;align-items:center;gap:6px}
  .refresh-btn:hover{border-color:var(--accent);color:var(--accent)}
  .refresh-btn.loading .icon{display:inline-block;animation:spin 1s linear infinite}
  @keyframes spin{to{transform:rotate(360deg)}}

  .container{position:relative;z-index:1;max-width:960px;margin:0 auto;padding:20px 16px 48px}
  .section-title{font-size:11px;font-weight:500;color:var(--muted);letter-spacing:2px;
    margin:28px 0 12px;display:flex;align-items:center;gap:8px}
  .pulse-dot{width:7px;height:7px;border-radius:50%;background:var(--up);animation:pulse 2s ease-in-out infinite;flex-shrink:0}
  @keyframes pulse{0%,100%{opacity:1;transform:scale(1)}50%{opacity:.4;transform:scale(.7)}}

  .grid{display:grid;grid-template-columns:repeat(2,1fr);gap:11px}
  @media(min-width:560px){.grid{grid-template-columns:repeat(3,1fr)}}
  @media(min-width:760px){.grid{grid-template-columns:repeat(4,1fr)}}

  .card{background:var(--card);border:1px solid var(--border);border-radius:18px;padding:16px 14px;
    transition:all .25s cubic-bezier(.4,0,.2,1);animation:fadeUp .4s ease both}
  .card:hover{background:var(--card-hover);transform:translateY(-3px);
    box-shadow:0 12px 40px rgba(0,0,0,.4);border-color:rgba(124,107,255,.3)}
  @keyframes fadeUp{from{opacity:0;transform:translateY(14px)}to{opacity:1;transform:translateY(0)}}

  .card-header{display:flex;align-items:center;gap:10px;margin-bottom:12px}
  .card-icon{width:34px;height:34px;border-radius:50%;display:flex;align-items:center;justify-content:center;font-size:18px;flex-shrink:0}
  .card-name-fa{font-size:12px;font-weight:600}
  .card-name-en{font-size:10px;color:var(--muted);margin-top:1px}
  .card-change{font-size:11px;font-weight:600;display:inline-flex;align-items:center;gap:2px;
    padding:3px 8px;border-radius:20px;margin-bottom:8px}
  .card-change.up{color:var(--up);background:rgba(0,230,118,.1)}
  .card-change.down{color:var(--down);background:rgba(255,82,82,.1)}
  .card-change.neutral{color:var(--muted);background:rgba(107,107,128,.1)}
  .card-price{font-size:20px;font-weight:800;letter-spacing:-.5px;line-height:1.1}
  .card-price .unit{font-size:10px;font-weight:400;color:var(--muted);margin-right:3px}

  .sk{background:linear-gradient(90deg,var(--border) 25%,rgba(255,255,255,.03) 50%,var(--border) 75%);
    background-size:200% 100%;animation:shimmer 1.5s infinite;border-radius:6px}
  @keyframes shimmer{0%{background-position:200% 0}100%{background-position:-200% 0}}

  .err{background:rgba(255,82,82,.1);border:1px solid rgba(255,82,82,.2);border-radius:12px;
    padding:12px 16px;font-size:13px;color:var(--down);margin-bottom:16px;display:none;line-height:1.8}

  footer{text-align:center;padding:24px;font-size:11px;color:var(--muted);
    border-top:1px solid var(--border);margin-top:16px}
</style>
</head>
<body>

<div class="ticker-bar"><div class="ticker-inner" id="ticker">âŸ³ Ø¯Ø± Ø­Ø§Ù„ Ø¨Ø§Ø±Ú¯Ø°Ø§Ø±ÛŒ...</div></div>

<header class="header">
  <div class="logo">Ú†Ù†Ø¯<span>ØŸ!</span></div>
  <div style="display:flex;align-items:center;gap:10px">
    <div class="last-update" id="lastUpdate">â€”</div>
    <button class="refresh-btn" onclick="loadAll()">
      <span class="icon">â†»</span><span>Ø¨Ø±ÙˆØ²Ø±Ø³Ø§Ù†ÛŒ</span>
    </button>
  </div>
</header>

<div class="container">
  <div class="err" id="err"></div>

  <div class="section-title"><span class="pulse-dot"></span> Ø§Ø±Ø²</div>
  <div class="grid" id="currencyGrid"></div>

  <div class="section-title">Ø·Ù„Ø§ Ùˆ Ø³Ú©Ù‡</div>
  <div class="grid" id="goldGrid"></div>

  <div class="section-title">Ø§Ø±Ø² Ø¯ÛŒØ¬ÛŒØªØ§Ù„</div>
  <div class="grid" id="cryptoGrid"></div>
</div>

<footer>Ù‚ÛŒÙ…Øªâ€ŒÙ‡Ø§ Ø§Ø² Ù…Ù†Ø§Ø¨Ø¹ Ù…Ø¹ØªØ¨Ø± â€” Ø¨Ø±ÙˆØ²Ø±Ø³Ø§Ù†ÛŒ Ø®ÙˆØ¯Ú©Ø§Ø± Ù‡Ø± Û² Ø¯Ù‚ÛŒÙ‚Ù‡</footer>

<script>
const CURRENCY = [
  {id:'usd',fa:'Ø¯Ù„Ø§Ø± Ø¢Ù…Ø±ÛŒÚ©Ø§',en:'USD',icon:'ğŸ‡ºğŸ‡¸',color:'#4fc3f7'},
  {id:'eur',fa:'ÛŒÙˆØ±Ùˆ',en:'EUR',icon:'ğŸ‡ªğŸ‡º',color:'#ab47bc'},
  {id:'gbp',fa:'Ù¾ÙˆÙ†Ø¯ Ø§Ù†Ú¯Ù„ÛŒØ³',en:'GBP',icon:'ğŸ‡¬ğŸ‡§',color:'#ef5350'},
  {id:'aed',fa:'Ø¯Ø±Ù‡Ù… Ø§Ù…Ø§Ø±Ø§Øª',en:'AED',icon:'ğŸ‡¦ğŸ‡ª',color:'#26c6da'},
  {id:'try',fa:'Ù„ÛŒØ± ØªØ±Ú©ÛŒÙ‡',en:'TRY',icon:'ğŸ‡¹ğŸ‡·',color:'#ff7043'},
  {id:'cad',fa:'Ø¯Ù„Ø§Ø± Ú©Ø§Ù†Ø§Ø¯Ø§',en:'CAD',icon:'ğŸ‡¨ğŸ‡¦',color:'#ec407a'},
  {id:'cny',fa:'ÛŒÙˆØ§Ù† Ú†ÛŒÙ†',en:'CNY',icon:'ğŸ‡¨ğŸ‡³',color:'#ff5252'},
  {id:'chf',fa:'ÙØ±Ø§Ù†Ú© Ø³ÙˆØ¦ÛŒØ³',en:'CHF',icon:'ğŸ‡¨ğŸ‡­',color:'#66bb6a'},
];
const GOLD = [
  {id:'geram18',fa:'Ø·Ù„Ø§ÛŒ Û±Û¸ Ø¹ÛŒØ§Ø±',en:'GOLD18',icon:'ğŸ¥‡',color:'#f5c842'},
  {id:'geram24',fa:'Ø·Ù„Ø§ÛŒ Û²Û´ Ø¹ÛŒØ§Ø±',en:'GOLD24',icon:'âœ¨',color:'#ffd54f'},
  {id:'mesghal',fa:'Ù…Ø«Ù‚Ø§Ù„ Ø·Ù„Ø§',en:'MITHQAL',icon:'âš–ï¸',color:'#ffca28'},
  {id:'ons',fa:'Ø§ÙˆÙ†Ø³ Ø¬Ù‡Ø§Ù†ÛŒ',en:'ONS',icon:'ğŸŒ',color:'#a5d6a7'},
  {id:'emami',fa:'Ø³Ú©Ù‡ Ø§Ù…Ø§Ù…ÛŒ',en:'EMAMI',icon:'ğŸª™',color:'#f5c842'},
  {id:'azadi',fa:'Ø³Ú©Ù‡ Ø¢Ø²Ø§Ø¯ÛŒ',en:'AZADI',icon:'ğŸ”µ',color:'#42a5f5'},
  {id:'nim',fa:'Ù†ÛŒÙ… Ø³Ú©Ù‡',en:'NIM',icon:'ğŸŸ¡',color:'#ffa726'},
  {id:'rob',fa:'Ø±Ø¨Ø¹ Ø³Ú©Ù‡',en:'ROB',icon:'ğŸŸ ',color:'#ff7043'},
];
const CRYPTO = [
  {id:'bitcoin',fa:'Ø¨ÛŒØªÚ©ÙˆÛŒÙ†',en:'BTC',icon:'â‚¿',color:'#f7931a'},
  {id:'ethereum',fa:'Ø§ØªØ±ÛŒÙˆÙ…',en:'ETH',icon:'âŸ ',color:'#627eea'},
  {id:'tether',fa:'ØªØªØ±',en:'USDT',icon:'â‚®',color:'#26a17b'},
  {id:'binancecoin',fa:'Ø¨Ø§ÛŒÙ†Ù†Ø³ Ú©ÙˆÛŒÙ†',en:'BNB',icon:'â—ˆ',color:'#f3ba2f'},
  {id:'solana',fa:'Ø³ÙˆÙ„Ø§Ù†Ø§',en:'SOL',icon:'â—',color:'#9945ff'},
  {id:'ripple',fa:'Ø±ÛŒÙ¾Ù„',en:'XRP',icon:'âœ•',color:'#346aa9'},
  {id:'cardano',fa:'Ú©Ø§Ø±Ø¯Ø§Ù†Ùˆ',en:'ADA',icon:'â‚³',color:'#0033ad'},
  {id:'dogecoin',fa:'Ø¯ÙˆØ¬â€ŒÚ©ÙˆÛŒÙ†',en:'DOGE',icon:'Ã',color:'#c2a633'},
];

function fmtNum(n) {
  if (n === null || n === undefined || isNaN(n)) return 'â€”';
  return Math.round(n).toLocaleString('fa-IR');
}

function card(item, price, chg, unit='ØªÙˆÙ…Ø§Ù†', delay=0) {
  const isUp=chg>0, isDown=chg<0;
  const cc=isUp?'up':isDown?'down':'neutral';
  const ci=isUp?'â–²':isDown?'â–¼':'â€”';
  const cv=chg!==null&&chg!==undefined ? Math.abs(chg).toLocaleString('fa-IR') : 'â€”';
  return `<div class="card" style="animation-delay:${delay}s">
    <div class="card-header">
      <div class="card-icon" style="background:${item.color}20">${item.icon}</div>
      <div><div class="card-name-fa">${item.fa}</div><div class="card-name-en">${item.en}</div></div>
    </div>
    <div class="card-change ${cc}">${ci} ${cv}</div>
    <div class="card-price">${price!==null?fmtNum(price):'â€”'}<span class="unit">${unit}</span></div>
  </div>`;
}

function skeleton(n) {
  return Array(n).fill(0).map(()=>`<div class="card">
    <div class="card-header">
      <div class="card-icon sk" style="width:34px;height:34px"></div>
      <div style="flex:1"><div class="sk" style="height:13px;width:70%;margin-bottom:4px"></div><div class="sk" style="height:10px;width:40%"></div></div>
    </div>
    <div class="sk" style="height:20px;width:50%;margin-bottom:8px;border-radius:20px"></div>
    <div class="sk" style="height:26px;width:80%"></div>
  </div>`).join('');
}

async function fetchJson(url, timeout=9000) {
  const ctrl = new AbortController();
  const t = setTimeout(()=>ctrl.abort(), timeout);
  try {
    const r = await fetch(url, {signal:ctrl.signal});
    if (!r.ok) throw new Error(`HTTP ${r.status}`);
    return await r.json();
  } finally { clearTimeout(t); }
}

// â”€â”€ Ø¯Ø±ÛŒØ§ÙØª Ù‚ÛŒÙ…Øªâ€ŒÙ‡Ø§ÛŒ Ø§ÛŒØ±Ø§Ù† â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
// Ø§Ø² Ø³Ù‡ Ù…Ù†Ø¨Ø¹ Ù…Ø®ØªÙ„Ù Ø§Ù…ØªØ­Ø§Ù† Ù…ÛŒâ€ŒÚ©Ù†ÛŒÙ…
async function fetchIran() {
  const errors = [];

  // Ù…Ù†Ø¨Ø¹ Û±: Navasan Ø§Ø² Ø·Ø±ÛŒÙ‚ corsproxy.io
  try {
    const data = await fetchJson(
      'https://corsproxy.io/?' + encodeURIComponent('https://sourceprice.navasan.ir/api/latest/?appkey=free')
    );
    if (data && (data.usd || data.USD)) return normalizeNavasan(data);
  } catch(e) { errors.push('navasan/corsproxy: ' + e.message); }

  // Ù…Ù†Ø¨Ø¹ Û²: Navasan Ø§Ø² Ø·Ø±ÛŒÙ‚ allorigins
  try {
    const res = await fetchJson(
      'https://api.allorigins.win/get?url=' + encodeURIComponent('https://sourceprice.navasan.ir/api/latest/?appkey=free')
    );
    if (res?.contents) {
      const data = JSON.parse(res.contents);
      if (data && data.usd) return normalizeNavasan(data);
    }
  } catch(e) { errors.push('navasan/allorigins: ' + e.message); }

  // Ù…Ù†Ø¨Ø¹ Û³: Ø³Ø§ÛŒØª ØªØ¨Ø¯ÛŒÙ„ Ø§Ø² Ø·Ø±ÛŒÙ‚ allorigins
  try {
    const res = await fetchJson(
      'https://api.allorigins.win/get?url=' + encodeURIComponent('https://call4.tgju.org/api/v1/currency/usd-irr?lang=fa')
    );
    if (res?.contents) {
      const data = JSON.parse(res.contents);
      return buildFallbackData(data);
    }
  } catch(e) { errors.push('tgju: ' + e.message); }

  throw new Error('Ø®Ø·Ø§ Ø¯Ø± Ù‡Ù…Ù‡ Ù…Ù†Ø§Ø¨Ø¹:\n' + errors.join('\n'));
}

function normalizeNavasan(d) {
  // navasan Ú¯Ø§Ù‡ÛŒ Ù…Ù‚Ø§Ø¯ÛŒØ± Ø±Ø§ Ø¨Ù‡ Ø±ÛŒØ§Ù„ Ø¨Ø±Ù…ÛŒÚ¯Ø±Ø¯Ø§Ù†Ø¯ØŒ ØªÙ‚Ø³ÛŒÙ… Ø¨Ø± Û±Û° Ù…ÛŒØ´Ù‡ ØªÙˆÙ…Ø§Ù†
  const toToman = v => v ? Math.round(parseFloat(v) / 10) : null;
  const n = {};
  // Ø§Ø±Ø²
  ['usd','eur','gbp','aed','try','cad','cny','chf','jpy'].forEach(k => {
    n[k]          = d[k]           ? toToman(d[k])           : null;
    n[k+'_change']= d[k+'_change'] ? toToman(d[k+'_change']) : null;
  });
  // Ø·Ù„Ø§
  ['geram18','geram24','mesghal','emami','azadi','nim','rob'].forEach(k => {
    n[k]          = d[k]           ? toToman(d[k])           : null;
    n[k+'_change']= d[k+'_change'] ? toToman(d[k+'_change']) : null;
  });
  n['ons'] = d['ons'] ? parseFloat(d['ons']) : null;
  return n;
}

function buildFallbackData(tgju) {
  // Ø¯Ø§Ø¯Ù‡â€ŒÙ‡Ø§ÛŒ Ù…Ø­Ø¯ÙˆØ¯ Ø§Ø² TGJU
  return { usd: tgju?.price ? Math.round(parseFloat(tgju.price)/10) : null };
}

// â”€â”€ Ø¯Ø±ÛŒØ§ÙØª Ú©Ø±ÛŒÙ¾ØªÙˆ (CoinGecko - CORS OK) â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
async function fetchCrypto() {
  const ids = CRYPTO.map(c=>c.id).join(',');
  return fetchJson(`https://api.coingecko.com/api/v3/simple/price?ids=${ids}&vs_currencies=usd&include_24hr_change=true`);
}

function buildTicker(nav, cg) {
  const items = [
    {name:'Ø¯Ù„Ø§Ø±',    val:nav.usd,          chg:nav.usd_change},
    {name:'ÛŒÙˆØ±Ùˆ',    val:nav.eur,          chg:nav.eur_change},
    {name:'Ù¾ÙˆÙ†Ø¯',    val:nav.gbp,          chg:nav.gbp_change},
    {name:'Ø¯Ø±Ù‡Ù…',    val:nav.aed,          chg:nav.aed_change},
    {name:'Ø·Ù„Ø§ Û±Û¸',  val:nav.geram18,      chg:nav.geram18_change},
    {name:'Ø§Ù…Ø§Ù…ÛŒ',   val:nav.emami,        chg:nav.emami_change},
    {name:'Ø¨ÛŒØªÚ©ÙˆÛŒÙ†', val:cg.bitcoin?.usd,  chg:cg.bitcoin?.usd_24h_change,  usd:true},
    {name:'Ø§ØªØ±ÛŒÙˆÙ…',  val:cg.ethereum?.usd, chg:cg.ethereum?.usd_24h_change, usd:true},
  ];
  const html = items.filter(i=>i.val).map(i => {
    const c = i.chg ? parseFloat(i.chg) : null;
    const cc = c>0?'up':c<0?'down':'';
    const ci = c>0?'â–²':c<0?'â–¼':'';
    return `<span class="ticker-item">
      <span class="name">${i.name}</span>
      ${fmtNum(parseFloat(i.val))} ${i.usd?'$':'Øª'}
      ${c!==null?`<span class="chg ${cc}">${ci}${Math.abs(c).toFixed(1)}%</span>`:''}
    </span>`;
  }).join('');
  document.getElementById('ticker').innerHTML = html + html;
}

async function loadAll() {
  const btn = document.querySelector('.refresh-btn');
  btn.classList.add('loading');
  const errEl = document.getElementById('err');
  errEl.style.display = 'none';
  ['currencyGrid','goldGrid','cryptoGrid'].forEach(g => {
    document.getElementById(g).innerHTML = skeleton(8);
  });

  try {
    const [nav, cg] = await Promise.all([fetchIran(), fetchCrypto()]);
    const usdToman = nav.usd ? parseFloat(nav.usd) : null;

    document.getElementById('currencyGrid').innerHTML =
      CURRENCY.map((it,i) => card(it, nav[it.id]??null, nav[it.id+'_change']??null, 'ØªÙˆÙ…Ø§Ù†', i*0.04)).join('');

    document.getElementById('goldGrid').innerHTML =
      GOLD.map((it,i) => card(it, nav[it.id]??null, nav[it.id+'_change']??null, 'ØªÙˆÙ…Ø§Ù†', i*0.04)).join('');

    document.getElementById('cryptoGrid').innerHTML =
      CRYPTO.map((it,i) => {
        const d = cg[it.id];
        if (!d) return card(it, null, null, 'Ø¯Ù„Ø§Ø±', i*0.04);
        const usdPrice  = d.usd;
        const chgPct    = d.usd_24h_change ? parseFloat(d.usd_24h_change.toFixed(2)) : null;
        const tomanPrice = usdToman ? Math.round(usdPrice * usdToman) : null;
        return card(it, tomanPrice||usdPrice, chgPct, tomanPrice?'ØªÙˆÙ…Ø§Ù†':'Ø¯Ù„Ø§Ø±', i*0.04);
      }).join('');

    buildTicker(nav, cg);

    const now = new Date();
    document.getElementById('lastUpdate').textContent =
      'Ø¢Ø®Ø±ÛŒÙ† Ø¨Ø±ÙˆØ²Ø±Ø³Ø§Ù†ÛŒ: ' + now.toLocaleTimeString('fa-IR',{hour:'2-digit',minute:'2-digit'});

  } catch(e) {
    errEl.innerHTML = 'âš ï¸ ' + e.message + '<br><small>VPN ÛŒØ§ Ø§ÛŒÙ†ØªØ±Ù†Øª Ø®ÙˆØ¯ Ø±Ø§ Ø¨Ø±Ø±Ø³ÛŒ Ú©Ù†ÛŒØ¯</small>';
    errEl.style.display = 'block';
    ['currencyGrid','goldGrid','cryptoGrid'].forEach(g => {
      document.getElementById(g).innerHTML =
        '<div style="color:var(--down);font-size:13px;padding:12px;grid-column:1/-1">Ø§Ø·Ù„Ø§Ø¹Ø§Øª Ø¯Ø± Ø¯Ø³ØªØ±Ø³ Ù†ÛŒØ³Øª</div>';
    });
  } finally {
    btn.classList.remove('loading');
  }
}

setInterval(loadAll, 120000);
loadAll();
</script>
</body>
</html>
